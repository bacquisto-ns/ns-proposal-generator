<!-- Deployment Heartbeat: 5 - Post-Billing API Enablement -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="NueSynergy Sales Opportunity Intake Portal - Streamlined lead capture and GHL integration.">
    <meta property="og:title" content="NueSynergy Sales Portal">
    <meta property="og:description" content="Capture lead information and create GHL opportunities efficiently.">
    <title>New Opportunity Intake - NueSynergy</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>

<body>
    <div class="container">
        <div class="portal-layout">
            <div class="portal-main">
                <div id="formSection">
            <a href="admin.html" class="btn secondary-btn btn-admin">Admin Dashboard</a>
            <div class="header">
                <h1>NueSynergy</h1>
                <p class="subtitle">Sales Opportunity Intake Portal</p>
            </div>

            <form id="opportunityForm">
                <div class="form-grid">
                    <!-- Opportunity Information -->
                    <!-- Employer Name and Postal Code Split Row -->
                    <!-- Employer Name and Postal Code Split Row -->
                    <div class="form-group">
                        <label for="employerName" class="required">Employer Name</label>
                        <input type="text" id="employerName" name="employerName" placeholder="Enter company name"
                            required>
                    </div>

                    <div class="form-group">
                        <label for="postalCode" class="required">Postal Code</label>
                        <input type="text" id="postalCode" name="postalCode" placeholder="Enter zip code" required>
                    </div>


                    <div class="form-group">
                        <label for="brokerName" class="required">Broker Name</label>
                        <div class="lookup-wrapper">
                            <input type="text" id="brokerName" name="brokerName" placeholder="Full name" required
                                autocomplete="off">
                            <div id="brokerLookupResults" class="lookup-results"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="brokerEmail" class="required">Broker Email</label>
                        <input type="email" id="brokerEmail" name="brokerEmail" placeholder="email@company.com"
                            required>
                    </div>

                    <div class="form-group">
                        <label for="effectiveDate" class="required">Effective Date</label>
                        <input type="date" id="effectiveDate" name="effectiveDate" required>
                    </div>

                    <div class="form-group">
                        <label for="proposalDate" class="required">Proposal Date</label>
                        <input type="date" id="proposalDate" name="proposalDate" required>
                    </div>

                    <div class="form-group">
                        <label for="totalEmployees" class="required">Total Number of Employees</label>
                        <input type="number" id="totalEmployees" name="totalEmployees" placeholder="e.g. 150" required
                            min="1">
                    </div>

                    <div class="form-group">
                        <label for="opportunitySource" class="required">Opportunity Source</label>
                        <select id="opportunitySource" name="opportunitySource" required>
                            <option value="" disabled selected>Select source...</option>
                            <option value="Broker">Broker</option>
                            <option value="Direct">Direct</option>
                            <option value="Referral">Referral</option>
                            <option value="Inbound">Inbound</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="brokerAgency">Broker Agency (if applicable)</label>
                        <input type="text" id="brokerAgency" name="brokerAgency" placeholder="Agency name">
                    </div>

                    <div class="form-group">
                        <label for="currentAdministrator">Current Administrator</label>
                        <input type="text" id="currentAdministrator" name="currentAdministrator" placeholder="Optional">
                    </div>

                    <div class="form-group">
                        <label for="benAdminSystem">Ben Admin System</label>
                        <input type="text" id="benAdminSystem" name="benAdminSystem" placeholder="Optional system name">
                    </div>

                    <div class="form-group">
                        <label for="assignedTo" class="required">Opportunity Owner</label>
                        <select id="assignedTo" name="assignedTo" required>
                            <option value="" disabled selected>Loading owners...</option>
                        </select>
                    </div>

                </div>

                <!-- Product Selection Section -->
                <section class="products-section">
                    <div class="section-header">
                        <h3>Products & Pricing</h3>
                        <button type="button" id="addProductBtn" class="secondary-btn">+ Add Product</button>
                    </div>
                    <div class="table-responsive">
                        <table class="product-table">
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>Pricing Tier</th>
                                    <th>Employees</th>
                                    <th>PEPM Override ($)</th>
                                    <th>Override</th>
                                    <th>Monthly Minimum</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="productBody">
                                <!-- Initial row will be added by JS -->
                            </tbody>
                        </table>
                    </div>
                    <div class="visually-hidden" aria-hidden="true">
                        <span id="grandTotal">$0.00</span>
                        <span id="yearlyTotal">$0.00</span>
                    </div>
                    <div id="approvalNotice" class="approval-notice" style="display: none;">
                        ⚠️ Notice: Price override applied. This request requires approval from President Josh Collins.
                    </div>
                </section>

                <button type="submit" id="submitBtn">Create Opportunity</button>
            </form>
        </div>

                <!-- Success View -->
                <div id="successMessage">
                    <div class="success-icon">
                        <svg viewBox="0 0 52 52" class="checkmark-svg">
                            <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none" />
                            <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8" />
                        </svg>
                    </div>
                    <div class="success-title">Opportunity Created!</div>
                    <p class="success-body" id="successDetail">The opportunity has been successfully added to the GHL
                        pipeline.
                    </p>
                    <button type="button" class="reset-btn" onclick="resetPortal()">Add Another Opportunity</button>
                </div>
            </div>

            <aside class="portal-summary" aria-live="polite">
                <div class="summary-card">
                    <div class="summary-title">Pricing Summary</div>
                    <div class="summary-total">
                        <span class="summary-label">Monthly</span>
                        <span id="summaryMonthly" class="summary-value">$0.00</span>
                    </div>
                    <div class="summary-total summary-total--secondary">
                        <span class="summary-label">Yearly</span>
                        <span id="summaryYearly" class="summary-value">$0.00</span>
                    </div>
                    <div class="summary-divider"></div>
                    <div class="summary-row">
                        <span>Employer</span>
                        <span id="summaryEmployer">--</span>
                    </div>
                    <div class="summary-row">
                        <span>Products</span>
                        <span id="summaryProductsCount">0</span>
                    </div>
                    <div class="summary-row">
                        <span>Employees</span>
                        <span id="summaryEmployees">0</span>
                    </div>
                    <div class="summary-row">
                        <span>Owner</span>
                        <span id="summaryOwner">Not selected</span>
                    </div>
                    <div class="summary-row">
                        <span>Effective</span>
                        <span id="summaryEffectiveDate">--</span>
                    </div>
                    <div class="summary-row">
                        <span>Proposal</span>
                        <span id="summaryProposalDate">--</span>
                    </div>
                    <div class="summary-row">
                        <span>Approval</span>
                        <span id="summaryApproval" class="summary-chip summary-chip--ok">Not required</span>
                    </div>
                </div>
                <div class="summary-card summary-card--list">
                    <div class="summary-title">Selected Products</div>
                    <div id="summaryProductsList" class="summary-product-list">
                        <div class="summary-empty">No products selected yet.</div>
                    </div>
                </div>
                <div class="summary-card summary-card--tip">
                    <div class="summary-title summary-title--with-icon">
                        <span class="summary-title-icon" aria-hidden="true">
                            <svg viewBox="0 0 24 24" focusable="false" aria-hidden="true">
                                <path fill="currentColor"
                                    d="M12 22a2.5 2.5 0 0 0 2.45-2h-4.9A2.5 2.5 0 0 0 12 22Zm7-6V11a7 7 0 0 0-6-6.92V3a1 1 0 1 0-2 0v1.08A7 7 0 0 0 5 11v5l-2 2v1h18v-1l-2-2Z" />
                            </svg>
                        </span>
                        Heads up
                    </div>
                    <p class="summary-tip">Overrides trigger approval and are flagged here instantly.</p>
                    <label class="summary-message-label" for="proposalMessage">
                        <span class="summary-label-icon" aria-hidden="true">
                            <svg viewBox="0 0 24 24" focusable="false" aria-hidden="true">
                                <path fill="currentColor"
                                    d="M4 4h16a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H8l-4 3v-3H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2Zm0 2v9h2v2.12L8.6 15H20V6H4Z" />
                            </svg>
                        </span>
                        Proposal message
                    </label>
                    <textarea id="proposalMessage" name="proposalMessage" form="opportunityForm"
                        class="summary-message-input" rows="3" maxlength="240"
                        placeholder="Add a short message that will appear on the proposal..."></textarea>
                    <div class="summary-message-help">Up to 240 characters.</div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Product Row Template -->
    <template id="productRowTemplate">
        <tr class="product-main-row">
            <td>
                <select class="product-select" required>
                    <option value="" disabled selected>Select Product</option>
                </select>
            </td>
            <td>
                <select class="tier-select"></select>
            </td>
            <td>
                <input type="number" class="employees-input" value="0" min="0">
            </td>
            <td>
                <input type="text" class="rate-input" readonly value="0.00">
            </td>
            <td class="text-center">
                <input type="checkbox" class="override-checkbox">
            </td>
            <td class="text-center">
                <input type="checkbox" class="waive-min-checkbox">
            </td>
            <td>
                <button type="button" class="remove-btn">&times;</button>
            </td>
        </tr>
        <tr class="override-justification-row" style="display: none;">
            <td colspan="7">
                <div class="override-justification">
                    <textarea class="justification-input" placeholder="Enter justification for price override..."
                        rows="2"></textarea>
                </div>
            </td>
        </tr>
    </template>

    <script src="ghl-api.js"></script>
</body>

</html>
